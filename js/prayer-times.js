// العناصر الرئيسية
const countrySelect = document.getElementById("country");
const citySelect = document.getElementById("city");
const fetchButton = document.getElementById("fetch-prayer-times");
const prayerTimesContainer = document.getElementById("prayer-times-container");
const errorMessage = document.getElementById("error-message");

// بيانات الدول العربية والمدن
const countries = {
    "مصر": [
        "القاهرة", "الإسكندرية", "الجيزة", "شبرا الخيمة", "بورسعيد", "السويس", "المنصورة", "أسيوط", "الأقصر", "أسوان",
        "دمياط", "المنيا", "بنها", "قنا", "سوهاج", "طنطا", "الزقازيق", "كفر الشيخ", "العريش", "دمنهور", "الفيوم", "بني سويف",
        "ميت غمر", "إدفو", "الخارجة", "مرسى مطروح", "شرم الشيخ", "دهب", "نويبع", "رأس سدر"
    ],
    "السعودية": [
        "الرياض", "جدة", "مكة", "المدينة المنورة", "الدمام", "الطائف", "بريدة", "تبوك", "نجران", "حفر الباطن",
        "الخبر", "حائل", "أبها", "ينبع", "القنفذة", "الجبيل", "الظهران", "القطيف", "عنيزة", "سكاكا", "جازان",
        "عرعر", "رفحاء", "ضباء", "الليث", "الخرج", "الدوادمي", "وادي الدواسر", "بيشة", "سراة عبيدة"
    ],
    "الإمارات": [
        "دبي", "أبو ظبي", "الشارقة", "عجمان", "رأس الخيمة", "الفجيرة", "أم القيوين", "العين", "خورفكان", "دبا الحصن",
        "مدينة زايد", "الرمس", "البدية", "مصفح", "السلع", "الذيد", "كلباء", "حتا", "خور دبي", "جبل علي"
    ],
    "الأردن": [
        "عمان", "الزرقاء", "إربد", "العقبة", "الكرك", "معان", "الطفيلة", "مادبا", "جرش", "عجلون",
        "الرمثا", "السلط", "الرصيفة", "وادي السير", "البقعة", "صويلح", "سحاب", "مأدبا", "الفحيص", "الكرامة"
    ],
    "العراق": [
        "بغداد", "البصرة", "الموصل", "أربيل", "السليمانية", "كربلاء", "النجف", "كركوك", "الناصرية", "العمارة",
        "الديوانية", "الحلة", "الرمادي", "الكوت", "سامراء", "الفاو", "زاخو", "دهوك", "الأنبار", "ذي قار"
    ],
    "المغرب": [
        "الرباط", "الدار البيضاء", "فاس", "مراكش", "طنجة", "مكناس", "وجدة", "أكادير", "تطوان", "القنيطرة",
        "الجديدة", "خريبكة", "بني ملال", "تازة", "آسفي", "وزان", "ورزازات", "الداخلة", "العيون", "السمارة"
    ],
    "الجزائر": [
        "الجزائر", "وهران", "قسنطينة", "عنابة", "باتنة", "سطيف", "بجاية", "البليدة", "تيزي وزو", "تلمسان",
        "الجلفة", "سكيكدة", "سيدي بلعباس", "الأغواط", "غرداية", "الشلف", "مستغانم", "الطارف", "خنشلة", "تيارت"
    ],
    "تونس": [
        "تونس", "صفاقس", "سوسة", "قابس", "بنزرت", "نابل", "القيروان", "قفصة", "المهدية", "جربة",
        "الكاف", "مدنين", "توزر", "منوبة", "زغوان", "بن عروس", "سليانة", "باجة", "قبلي", "تطاوين"
    ],
    "ليبيا": [
        "طرابلس", "بنغازي", "مصراتة", "الزاوية", "سبها", "الخمس", "زليتن", "غريان", "البيضاء", "درنة",
        "طبرق", "سرت", "الأصابعة", "المرج", "الجفرة", "وادي الشاطئ", "نالوت", "يفرن", "غات", "أوباري"
    ],
    "السودان": [
        "الخرطوم", "أم درمان", "بورتسودان", "ود مدني", "الأبيض", "نيالا", "كادقلي", "الفاشر", "القضارف", "كسلا",
        "سنار", "الدويم", "ربك", "الدامر", "عطبرة", "شندي", "بربر", "حلفا الجديدة", "كوستي", "جنينة"
    ],
    "اليمن": [
        "صنعاء", "عدن", "تعز", "الحديدة", "إب", "المكلا", "ذمار", "حجة", "المحويت", "عمران",
        "ريمة", "صعدة", "شبوة", "مأرب", "الجوف", "لحج", "أبين", "ضالع", "بيحان", "يريم"
    ],
    "سوريا": [
        "دمشق", "حلب", "حمص", "حماة", "اللاذقية", "دير الزور", "الحسكة", "الرقة", "إدلب", "السويداء",
        "درعا", "طرطوس", "القنيطرة", "بانياس", "جبلة", "معرة النعمان", "أريحا", "تلكلخ", "صافيتا", "القدموس"
    ],
    "لبنان": [
        "بيروت", "طرابلس", "صيدا", "زحلة", "جبيل", "النبطية", "بعلبك", "صور", "عنجر", "بترون",
        "جونية", "مرجعيون", "الهرمل", "راشيا", "زغرتا", "بشري", "دير القمر", "عين دارة", "الدامور", "الناعمة"
    ],
    "فلسطين": [
        "القدس", "غزة", "رام الله", "الخليل", "نابلس", "بيت لحم", "جنين", "أريحا", "طولكرم", "قلقيلية",
        "رفح", "خان يونس", "دير البلح", "البيرة", "بيت جالا", "بيت ساحور", "طوباس", "سلفيت", "يعبد", "عقابا"
    ],
    "عُمان": [
        "مسقط", "صلالة", "صور", "نزوى", "صحار", "البريمي", "السيب", "عبري", "الرستاق", "الباطنة",
        "خصب", "مطرح", "بركاء", "شناص", "لوى", "دماء والطائيين", "بدبد", "سمائل", "وادي بني خالد", "المصنعة"
    ],
    "الكويت": [
        "الكويت", "الفروانية", "حولي", "الأحمدي", "الجهراء", "مبارك الكبير", "العديلية", "الرميثية", "الخالدية", "الدسمة",
        "الفيحاء", "الشامية", "الروضة", "النهضة", "المنقف", "الظهر", "القرين", "الوفرة", "الصليبية", "الجليعة"
    ],
    "قطر": [
        "الدوحة", "الريان", "الوكرة", "الخور", "الشمال", "أم صلال", "الشميرية", "الزبارة", "الرويس", "الغويرية",
        "الخريطيات", "الوسيل", "الريان الجديدة", "الريان القديمة", "الريان الصناعية", "الريان الغربية", "الريان الشرقية", "الريان الجنوبية", "الريان الشمالية", "الريان الوسطى"
    ],
    "البحرين": [
        "المنامة", "المحرق", "الرفاع", "مدينة حمد", "جد حفص", "سترة", "الدراز", "البديع", "الحد", "الجنبية",
        "المالكية", "دمستان", "بوري", "كرزكان", "عراد", "سند", "النعيم", "الهملة", "السنابس", "المقشع"
    ],
    "موريتانيا": [
        "نواكشوط", "نواذيبو", "كيهيدي", "زويرات", "روصو", "ألاك", "كيفة", "أطار", "تكانت", "تيرس زمور",
        "غيديماغا", "الحوض الشرقي", "الحوض الغربي", "لعصابة", "لبراكنة", "تيرس", "إنشيري", "أدرار", "تكانت", "غورغول"
    ],
    "الصومال": [
        "مقديشو", "هرجيسا", "بوساسو", "جالكعيو", "كيسمايو", "بربرة", "بيلدغلين", "جوريال", "لاسعانود", "بورمه",
        "أودويني", "غالكعيو", "جروي", "عيرجابو", "قوريولي", "بردرة", "دولاو", "جروي", "عيرجابو", "قوريولي"
    ],
    "جيبوتي": [
        "جيبوتي", "علي صبيح", "تاجورة", "أوبوك", "دخيل", "خور أنغار", "علي صبيح", "تاجورة", "أوبوك", "دخيل",
        "خور أنغار", "علي صبيح", "تاجورة", "أوبوك", "دخيل", "خور أنغار", "علي صبيح", "تاجورة", "أوبوك", "دخيل"
    ],
    "جزر القمر": [
        "موروني", "موتسامودو", "فومبوني", "دوموني", "تسينجوني", "نياوماشوا", "موروني", "موتسامودو", "فومبوني", "دوموني",
        "تسينجوني", "نياوماشوا", "موروني", "موتسامودو", "فومبوني", "دوموني", "تسينجوني", "نياوماشوا", "موروني", "موتسامودو"
    ]
};

// تعبئة الدول العربية
for (const country in countries) {
    const option = document.createElement("option");
    option.value = country;
    option.textContent = country;
    countrySelect.appendChild(option);
}

// تعبئة المدن بناءً على الدولة المختارة
countrySelect.addEventListener("change", () => {
    const selectedCountry = countrySelect.value;
    citySelect.innerHTML = '<option value="">اختر المدينة</option>'; // استخدام علامات اقتباس مفردة

    if (selectedCountry) {
        countries[selectedCountry].forEach(city => {
            const option = document.createElement("option");
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });
    }
});

// دالة لجلب مواقيت الصلاة
async function fetchPrayerTimes() {
    const city = citySelect.value.trim();
    const country = countrySelect.value.trim();

    if (!city || !country) {
        showError("الرجاء اختيار الدولة والمدينة.");
        return;
    }

    try {
        const apiUrl = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=5`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("حدث خطأ أثناء جلب البيانات من الخادم.");

        const data = await response.json();
        const timings = data.data.timings;

        // عرض مواقيت الصلاة
        const html = `
            <div class="prayer-time">
                <span>الفجر:</span> ${timings.Fajr}
            </div>
            <div class="prayer-time">
                <span>الشروق:</span> ${timings.Sunrise}
            </div>
            <div class="prayer-time">
                <span>الظهر:</span> ${timings.Dhuhr}
            </div>
            <div class="prayer-time">
                <span>العصر:</span> ${timings.Asr}
            </div>
            <div class="prayer-time">
                <span>المغرب:</span> ${timings.Maghrib}
            </div>
            <div class="prayer-time">
                <span>العشاء:</span> ${timings.Isha}
            </div>
        `;

        prayerTimesContainer.innerHTML = html;
        errorMessage.textContent = ""; // إخفاء رسالة الخطأ
    } catch (error) {
        console.error("Error:", error);
        showError("حدث خطأ أثناء جلب مواقيت الصلاة. الرجاء التأكد من صحة البيانات المدخلة.");
    }
}

// دالة لعرض رسائل الخطأ
function showError(message) {
    errorMessage.textContent = message;
    prayerTimesContainer.innerHTML = "<p>الرجاء اختيار الدولة والمدينة.</p>";
}

// حدث الضغط على زر عرض المواقيت
fetchButton.addEventListener("click", fetchPrayerTimes);